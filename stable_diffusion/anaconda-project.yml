# To reproduce: install 'anaconda-project', then 'anaconda-project run'

# required: name MUST match the directory name.
#           name must be of the form r'[a-z_]+'
name: stable_diffusion
# required: short project description, used in the main gallery
description: An example panel app for stable diffusion

# required: config 
examples_config:
  #### REQUIRED ###
  # Creation date following the YYYY-MM-DD format
  created: 2022-01-30
  # List of the GITHUB handle of the authors/maintainers
  maintainers:
  - "sandhujasmine"
  # List of labels displayed in the project card
  # Each label must be a name (e.g. panel) that
  # refers to a SVG badge located in doc/_static/labels
  # (e.g. doc/_static/labels/panel.svg)
  labels:
  - "panel"

  # to build the website (e.g. too long or require too much data).
  # This indicates the system not to run them.
  skip_notebooks_evaluation: false
  # For projects that get their data either by:
  # - automatically generating it
  # - providing indications
  no_data_ingestion: false

# required: (needed internally)
user_fields: [examples_config]

# required: list of the channels needed to solve the environment
channels:
- pyviz
- conda-forge
  # To remove the default channel, if need be.
# - nodefaults

# required: list of the direct dependencies needed to run the project.
# Good practice is to pin their minimum version (>=) to indicate the
# version with which the project has been created. Updates to the project
# should updates these pins, if relevant.
packages: &pkgs
## required: must be installed 
- notebook >=6.5.2
# following min versions work well together from conda-forge & pyviz
# These are common dependencies for both platforms. The pytorch package is defined
# in the env-spec since that is currently installed from different channels
- panel >=0.14.2
- diffusers >=0.11.1
- transformers >=4.24.0
- ftfy >=6.1.1
- accelerate >=0.15.0

dependencies: *pkgs

# required: define the commands the project user may run (e.g. anaconda-project run notebook)
commands:
  # if you intend to run notebooks, set the `notebook` command
  notebook:
    # reference a single notebook in your project
    notebook: stable_diffusion.ipynb
    # shortcut to open all the notebook
    # notebook: .
  # if you intend to deploy a panel/lumen app, set the `dashboard` command
  dashboard:
    # the `--rest-session-info --session-history -1` options are required
    unix: panel serve --rest-session-info --session-history -1 stable_diffusion.ipynb --static-dirs thumbnails=./thumbnails
    supports_http_options: true
  notebook-m1:
    # reference a single notebook in your project
    notebook: stable_diffusion.ipynb
    env_spec: stable-diffusion-m1
    # shortcut to open all the notebook
    # notebook: .
  # if you intend to deploy a panel/lumen app, set the `dashboard` command
  dashboard-m1:
    # the `--rest-session-info --session-history -1` options are required
    unix: panel serve --rest-session-info --session-history -1 stable_diffusion.ipynb --static-dirs thumbnails=./thumbnails
    supports_http_options: true
    env_spec: stable-diffusion-m1
  
# optional environment variables
variables: {}

# optional downloads
downloads: {}
platforms:
- linux-64

#
# You can define multiple, named environment specs.
# Each inherits any global packages or channels,
# but can have its own unique ones also.
# Use `anaconda-project add-env-spec` to add environment specs.
env_specs:
  default:
    description: Default environment spec for running commands
    packages: 
    - python >=3.11.0
    - pytorch >=1.13.0
    channels: 
    - conda-forge
    - nodefaults
    platforms: 
    - linux-64
  stable-diffusion-m1:
    description: Env for osx-arm64 M1 for running app
    packages:
    - python>=3.10,<3.11.0a0
    - pytorch >=1.13.1
    channels:
    - pytorch
    - conda-forge
    platforms: 
    - osx-arm64
